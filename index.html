<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta content="IE=edge">
        <title>Document</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"/>
        <link rel="stylesheet" href="main.css"/>
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    </head>
    <body>
        <div id="mainFrame">
            <p><b>Today exams:</b>
                <label id="today">
                    loading...
                </label>
            </p>
            <p><b>Tomorrow exams:</b> 
                <label id="tomorrow">
                    loading...
                </label>
            </p>
            <p><b>Week exams: </b>
                <label id="week">
                    loading...
                </label>
            </p>
            <p><b>Later exams: </b>
                <label id="later">
                    loading...
                </label>
            </p>
            <h4 id="error"></h4>
        </div>
        <py-script>
from pyodide.http import pyfetch
import datetime

response = await pyfetch(url="https://api.jsonstorage.net/v1/json/81b5d14c-0fe3-4cac-8fec-4f7f954630d0/c24ccd0e-67d3-4fc3-9756-267a4c4f6c0f", method="GET")
response_dict = await response.json()

missing = '<div id="nothing"><i>Žádné naplánované úkoly.</i></div>'

if response_dict["error"] is True:
    pyscript.write('error', response_dict['errMsg'])

if len(response_dict["today"]) > 0:
    builded = "<ul>"
    for i in response_dict["today"]:
        builded += "<li>" + i["info"] + "</li>"
    builded += "</ul>"
    pyscript.write('today', builded)
else:
    pyscript.write('today', missing)

if len(response_dict["tomorrow"]) > 0:
    builded = "<ul>"
    for i in response_dict["tomorrow"]:
        builded += "<li>" + i["info"] + "</li>"
    builded += "</ul>"
    pyscript.write('tomorrow', builded)
else:
    pyscript.write('tomorrow', missing)

if len(response_dict["week"]) > 0:
    builded = "<ul>"
    for i in response_dict["week"]:
        builded += "<li>" + datetime.datetime.fromtimestamp(i["date"]).strftime('%d.%m.%Y') + ": " + i["info"] + "</li>"
    builded += "</ul>"
    pyscript.write('week', builded)
else:
    pyscript.write('week', missing)

if len(response_dict["later"]) > 0:
    builded = "<ul>"
    for i in response_dict["later"]:
        builded += "<li>" + datetime.datetime.fromtimestamp(i["date"]).strftime('%d.%m.%Y') + ": " + i["info"] + "</li>"
    builded += "</ul>"
    pyscript.write('later', builded)
else:
    pyscript.write('later', missing)
        </py-script>
    </body>
</html>